<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon C≈ìur pour Toi</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Raleway:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --bg-color: #1a2a2a; }
        body { margin: 0; font-family: 'Raleway', sans-serif; background-color: var(--bg-color); color: white; overflow-x: hidden; transition: 1s; }
        
        .container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
        .section-box { background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(15px); border-radius: 25px; padding: 35px; margin-bottom: 40px; }
        .box-header { font-family: 'Great Vibes', cursive; font-size: 3.8em; text-align: center; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.15); padding-bottom: 10px; }
        .poem-content { font-family: 'Great Vibes', cursive; font-size: 2.6em; text-align: center; white-space: pre-line; }

        .memory-card { background: white; color: #333; border-radius: 20px; padding: 15px; margin-bottom: 25px; }
        .memory-card img { width: 100%; border-radius: 15px; display: block; }
        .mem-title { font-family: 'Great Vibes', cursive; font-size: 2.4em; color: #1a2a2a; margin: 10px 0 5px 0; text-align: center; }

        /* √âDITEUR */
        #editor-ui input, #editor-ui textarea { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: white; margin-bottom: 15px; box-sizing: border-box; }
        .btn-gen { background: white; color: black; border: none; padding: 20px; border-radius: 50px; cursor: pointer; width: 100%; font-weight: bold; }
        
        /* BOUTON DE PARTAGE (APPARA√éT APR√àS) */
        #share-area { display: none; text-align: center; margin-bottom: 20px; position: sticky; top: 10px; z-index: 10002; }
        .btn-share { background: #25d366; color: white; border: none; padding: 15px 30px; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        
        /* √âCRANS */
        #welcome-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-color); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
        .heart-trigger { fill: white; width: 100px; height: 100px; cursor: pointer; animation: beat 1.4s infinite; }
        @keyframes beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        
        #music-toggle { position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; background: white; border-radius: 50%; display: none; align-items: center; justify-content: center; z-index: 10000; cursor: pointer; }
        #back-to-editor { position: fixed; top: 10px; left: 10px; background: rgba(255,255,255,0.2); color: white; border: none; padding: 10px; border-radius: 10px; cursor: pointer; z-index: 10001; display: none; }

        .hidden { display: none !important; }
        canvas { position: fixed; top: 0; left: 0; z-index: -1; pointer-events: none; }
    </style>
</head>
<body>

<canvas id="canvas-particles"></canvas>

<button id="back-to-editor" onclick="location.reload()">‚¨Ö Modifier</button>
<div id="share-area">
    <button class="btn-share" onclick="copyMagicLink()">üîó Copier le lien pour mon Mari</button>
</div>

<div class="container" id="editor-ui">
    <div class="section-box">
        <h1 style="font-family:'Great Vibes'; text-align:center; font-size:3.5em; margin:0 0 20px 0;">Atelier de Mme Thiandoum</h1>
        <label>Couleur fond</label><input type="color" id="user-color" value="#1a2a2a">
        <label>Musique (MP3)</label><input type="file" id="user-mp3" accept="audio/mp3" onchange="handleMusicUpload(this)">
        <label>Ton Po√®me</label><textarea id="user-poem" rows="4"></textarea>
        <label>Signature</label><input type="text" id="user-sig">
        <label>Photo</label><input type="file" id="user-img" accept="image/*">
        <input type="text" id="user-img-title" placeholder="Titre de la photo">
        <label>Qualit√©s / Promesses</label>
        <textarea id="user-qualities" placeholder="Ses qualit√©s..."></textarea>
        <textarea id="user-promises" placeholder="Tes promesses..."></textarea>

        <button class="btn-gen" onclick="previewSite()">Voir le r√©sultat ‚ú®</button>
    </div>
</div>

<div id="welcome-screen">
    <svg class="heart-trigger" onclick="unlockSite()" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
    <div style="font-family:'Great Vibes'; font-size:3em; margin-top:20px;">Ouvre-moi...</div>
</div>

<div class="container hidden" id="final-site">
    <div class="section-box">
        <div class="box-header">Pour Toi...</div>
        <div class="poem-content" id="display-poem"></div>
        <div id="display-sig" style="text-align:right; font-family:'Great Vibes'; font-size:2.5em; margin-top:20px;"></div>
    </div>
    <div id="display-memories"></div>
    <div class="section-box"><div class="box-header">Ce que j'aime</div><div id="display-qualities" style="white-space: pre-line;"></div></div>
    <div class="section-box"><div class="box-header">Mes Promesses</div><div id="display-promises" style="white-space: pre-line;"></div></div>
</div>

<div id="music-toggle" onclick="toggleAudio()"><svg viewBox="0 0 24 24" style="fill:#1a2a2a; width:30px;"><path d="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.85 14,18.71V20.77C18.03,19.86 21,16.28 21,12C21,7.72 18.03,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16.02C15.5,15.29 16.5,13.77 16.5,12M3,9V15H7L12,20V4L7,9H3Z"/></svg></div>
<audio id="main-audio" loop></audio>

<script>
    const params = new URLSearchParams(window.location.search);
    
    // CAS DU MARI : On cache tout l'atelier et les boutons de contr√¥le
    if(params.has('d')) {
        document.getElementById('editor-ui').classList.add('hidden');
        document.getElementById('share-area').classList.add('hidden');
        const data = JSON.parse(decodeURIComponent(escape(atob(params.get('d')))));
        window.addEventListener('load', () => {
            fillSite(data);
            document.getElementById('welcome-screen').style.display = 'flex';
            document.body.style.backgroundColor = data.c;
            startParticles();
        });
    }

    function handleMusicUpload(input) {
        if (input.files[0]) document.getElementById('main-audio').src = URL.createObjectURL(input.files[0]);
    }

    function previewSite() {
        const data = { p: document.getElementById('user-poem').value, s: document.getElementById('user-sig').value, q: document.getElementById('user-qualities').value, pr: document.getElementById('user-promises').value, c: document.getElementById('user-color').value };
        fillSite(data);
        
        // Photo
        const file = document.getElementById('user-img').files[0];
        if(file) {
            const url = URL.createObjectURL(file);
            document.getElementById('display-memories').innerHTML = `<div class="section-box"><div class="memory-card"><img src="${url}"><div class="mem-title">${document.getElementById('user-img-title').value}</div></div></div>`;
        }

        // Passage en mode preview
        document.getElementById('editor-ui').classList.add('hidden');
        document.getElementById('welcome-screen').style.display = 'flex';
        document.getElementById('back-to-editor').style.display = 'block';
        document.getElementById('share-area').style.display = 'block'; // LE BOUTON APPARA√éT ICI
        document.body.style.backgroundColor = data.c;
        startParticles();
    }

    function fillSite(data) {
        document.getElementById('display-poem').innerText = data.p;
        document.getElementById('display-sig').innerText = data.s;
        document.getElementById('display-qualities').innerText = data.q;
        document.getElementById('display-promises').innerText = data.pr;
    }

    function copyMagicLink() {
        const data = { p: document.getElementById('user-poem').value, s: document.getElementById('user-sig').value, q: document.getElementById('user-qualities').value, pr: document.getElementById('user-promises').value, c: document.getElementById('user-color').value };
        const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
        const url = window.location.origin + window.location.pathname + '?d=' + encoded;
        navigator.clipboard.writeText(url).then(() => alert("Lien copi√© ! C'est ce lien qu'il faut envoyer √† ton mari."));
    }

    function unlockSite() {
        document.getElementById('welcome-screen').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('final-site').classList.remove('hidden');
            if(document.getElementById('main-audio').src) {
                document.getElementById('music-toggle').style.display = 'flex';
                document.getElementById('main-audio').play();
            }
        }, 1000);
    }

    function toggleAudio() {
        const a = document.getElementById('main-audio'); a.paused ? a.play() : a.pause();
    }

    function startParticles() {
        const canvas = document.getElementById('canvas-particles'); const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let ps = []; for(let i=0; i<30; i++) ps.push({x: Math.random()*canvas.width, y: canvas.height+50, s: Math.random()*20+10, v: Math.random()*0.5+0.2});
        function anim() {
            ctx.clearRect(0,0,canvas.width, canvas.height); ctx.fillStyle="rgba(255,255,255,0.2)";
            ps.forEach(p => { ctx.font=p.s+"px serif"; ctx.fillText("‚ù§", p.x, p.y); p.y-=p.v; if(p.y<-50) p.y=canvas.height+50; });
            requestAnimationFrame(anim);
        }
        anim();
    }
</script>
</body>
</html>
