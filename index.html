<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon C≈ìur pour Toi</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Raleway:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --bg-color: #1a2a2a; }
        body { margin: 0; font-family: 'Raleway', sans-serif; background-color: var(--bg-color); color: white; overflow-x: hidden; transition: 1s; }
        
        /* --- DESIGN --- */
        .container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
        .section-box { background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(15px); border-radius: 25px; padding: 35px; margin-bottom: 40px; }
        .box-header { font-family: 'Great Vibes', cursive; font-size: 3.8em; text-align: center; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.15); padding-bottom: 10px; }
        .poem-content { font-family: 'Great Vibes', cursive; font-size: 2.6em; text-align: center; white-space: pre-line; }

        /* --- SOUVENIRS (PHOTOS) --- */
        .memory-card { background: white; color: #333; border-radius: 20px; padding: 15px; margin-bottom: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .memory-card img { width: 100%; border-radius: 15px; display: block; }
        .mem-title { font-family: 'Great Vibes', cursive; font-size: 2.4em; color: #1a2a2a; margin: 10px 0 5px 0; text-align: center; }
        .mem-text { font-size: 1em; color: #555; text-align: center; padding-bottom: 10px; }

        /* --- √âDITEUR --- */
        #editor-ui input, #editor-ui textarea { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: white; margin-bottom: 15px; box-sizing: border-box; font-family: 'Raleway'; }
        .btn-gen { background: white; color: black; border: none; padding: 20px; border-radius: 50px; cursor: pointer; width: 100%; font-weight: bold; font-size: 1.1em; margin-bottom: 10px; }
        .btn-share { background: #25d366; color: white; border: none; padding: 20px; border-radius: 50px; cursor: pointer; width: 100%; font-weight: bold; font-size: 1.1em; }
        
        /* --- √âCRANS --- */
        #welcome-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-color); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
        .heart-trigger { fill: white; width: 100px; height: 100px; cursor: pointer; animation: beat 1.4s infinite; filter: drop-shadow(0 0 15px white); }
        @keyframes beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.15); } }
        
        #back-to-editor { position: fixed; top: 15px; left: 15px; background: rgba(0,0,0,0.6); color: white; border: none; padding: 10px 20px; border-radius: 30px; cursor: pointer; display: none; z-index: 10001; }
        #music-toggle { position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; background: white; border-radius: 50%; display: none; align-items: center; justify-content: center; z-index: 10000; box-shadow: 0 4px 15px rgba(0,0,0,0.3); cursor: pointer; }

        .hidden { display: none !important; }
        canvas { position: fixed; top: 0; left: 0; z-index: -1; pointer-events: none; }
    </style>
</head>
<body>

<canvas id="canvas-particles"></canvas>
<button id="back-to-editor" onclick="returnToEditor()">‚¨Ö Modifier mon texte</button>

<div class="container" id="editor-ui">
    <div class="section-box">
        <h1 style="font-family:'Great Vibes'; text-align:center; font-size:3.5em; margin:0 0 20px 0;">Atelier de Mme Thiandoum</h1>
        
        <label>Couleur du fond</label>
        <input type="color" id="user-color" value="#1a2a2a" onchange="document.body.style.backgroundColor=this.value">
        
        <label>üéµ Ta Musique (MP3)</label>
        <input type="file" id="user-mp3" accept="audio/mp3" onchange="handleMusicUpload(this)">
        
        <label>Ton Po√®me</label>
        <textarea id="user-poem" rows="4" placeholder="√âcris ici tes mots les plus doux..."></textarea>
        
        <label>Signature</label>
        <input type="text" id="user-sig" placeholder="Ex: Ta femme qui t'aime">

        <label>üì∏ Tes Souvenirs (Photos)</label>
        <div id="mem-inputs-area">
            <div style="background:rgba(255,255,255,0.05); padding:15px; border-radius:15px; margin-bottom:10px;">
                <input type="file" class="mem-img" accept="image/*">
                <input type="text" class="mem-title-in" placeholder="Titre (ex: Notre Mariage)">
                <textarea class="mem-desc-in" rows="2" placeholder="Description..."></textarea>
            </div>
        </div>
        <button onclick="addMemInput()" style="background:none; border:1px solid white; color:white; width:100%; padding:10px; border-radius:10px; cursor:pointer; margin-bottom:20px;">+ Ajouter un autre souvenir</button>

        <label>Ses Qualit√©s / Tes Promesses</label>
        <textarea id="user-qualities" rows="3" placeholder="Qualit√©s (une par ligne)..."></textarea>
        <textarea id="user-promises" rows="3" placeholder="Promesses (une par ligne)..."></textarea>

        <button class="btn-gen" onclick="previewSite()">1. Tester le rendu ‚ú®</button>
        <button class="btn-share" onclick="copyMagicLink()">2. Copier le lien pour mon Mari üîó</button>
    </div>
</div>

<div id="welcome-screen">
    <svg class="heart-trigger" onclick="unlockSite()" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
    <div style="font-family:'Great Vibes'; font-size:3em; margin-top:20px;">Ouvre-moi...</div>
</div>

<div class="container hidden" id="final-site">
    <div class="section-box">
        <div class="box-header">Pour Toi...</div>
        <div class="poem-content" id="display-poem"></div>
        <div id="display-sig" style="text-align:right; font-family:'Great Vibes'; font-size:2.5em; margin-top:20px;"></div>
    </div>

    <div id="display-memories"></div>

    <div class="section-box">
        <div class="box-header">Ce que j'aime chez toi</div>
        <div id="display-qualities" class="box-content"></div>
    </div>

    <div class="section-box">
        <div class="box-header">Mes Promesses</div>
        <div id="display-promises" class="box-content"></div>
    </div>
</div>

<div id="music-toggle" onclick="toggleAudio()">
    <svg viewBox="0 0 24 24" style="fill:#1a2a2a; width:30px;"><path d="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.85 14,18.71V20.77C18.03,19.86 21,16.28 21,12C21,7.72 18.03,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16.02C15.5,15.29 16.5,13.77 16.5,12M3,9V15H7L12,20V4L7,9H3Z"/></svg>
</div>

<audio id="main-audio" loop></audio>

<script>
    function handleMusicUpload(input) {
        if (input.files[0]) document.getElementById('main-audio').src = URL.createObjectURL(input.files[0]);
    }

    function addMemInput() {
        const div = document.createElement('div');
        div.style = "background:rgba(255,255,255,0.05); padding:15px; border-radius:15px; margin-bottom:10px;";
        div.innerHTML = `<input type="file" class="mem-img" accept="image/*"><input type="text" class="mem-title-in" placeholder="Titre"><textarea class="mem-desc-in" rows="2" placeholder="Description..."></textarea>`;
        document.getElementById('mem-inputs-area').appendChild(div);
    }

    function previewSite() {
        const data = { p: document.getElementById('user-poem').value, s: document.getElementById('user-sig').value, q: document.getElementById('user-qualities').value, pr: document.getElementById('user-promises').value, c: document.getElementById('user-color').value };
        fillSite(data);
        
        // Affichage des souvenirs
        const memDisp = document.getElementById('display-memories');
        memDisp.innerHTML = '';
        const images = document.querySelectorAll('.mem-img');
        images.forEach((inp, i) => {
            const file = inp.files[0];
            if(file) {
                const url = URL.createObjectURL(file);
                const title = document.querySelectorAll('.mem-title-in')[i].value;
                const desc = document.querySelectorAll('.mem-desc-in')[i].value;
                memDisp.innerHTML += `<div class="section-box"><div class="memory-card"><img src="${url}"><div class="mem-title">${title}</div><div class="mem-text">${desc}</div></div></div>`;
            }
        });

        document.getElementById('editor-ui').classList.add('hidden');
        document.getElementById('welcome-screen').style.display = 'flex';
        document.getElementById('back-to-editor').style.display = 'block';
        startParticles();
    }

    function fillSite(data) {
        document.getElementById('display-poem').innerText = data.p;
        document.getElementById('display-sig').innerText = data.s;
        const fmt = (id, txt) => {
            const el = document.getElementById(id); el.innerHTML = '';
            txt.split('\n').forEach(l => { if(l.trim()) el.innerHTML += `<div style="background:rgba(255,255,255,0.1); margin:10px 0; padding:15px; border-radius:15px; border-left:4px solid white;">‚ù§ ${l}</div>`; });
        };
        fmt('display-qualities', data.q); fmt('display-promises', data.pr);
    }

    function unlockSite() {
        document.getElementById('welcome-screen').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('final-site').classList.remove('hidden');
            document.getElementById('music-toggle').style.display = 'flex';
            if(document.getElementById('main-audio').src) document.getElementById('main-audio').play();
        }, 1000);
    }

    function returnToEditor() {
        document.getElementById('editor-ui').classList.remove('hidden');
        document.getElementById('welcome-screen').style.display = 'none';
        document.getElementById('final-site').classList.add('hidden');
        document.getElementById('back-to-editor').style.display = 'none';
        document.getElementById('main-audio').pause();
    }

    function toggleAudio() {
        const a = document.getElementById('main-audio'); a.paused ? a.play() : a.pause();
    }

    function copyMagicLink() {
        const data = { p: document.getElementById('user-poem').value, s: document.getElementById('user-sig').value, q: document.getElementById('user-qualities').value, pr: document.getElementById('user-promises').value, c: document.getElementById('user-color').value };
        const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
        const url = window.location.href.split('?')[0] + '?d=' + encoded;
        navigator.clipboard.writeText(url).then(() => alert("Lien copi√© ! Envoie-le √† ton mari."));
    }

    function startParticles() {
        const canvas = document.getElementById('canvas-particles'); const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let ps = []; for(let i=0; i<30; i++) ps.push({x: Math.random()*canvas.width, y: canvas.height+50, s: Math.random()*20+10, v: Math.random()*0.5+0.2});
        function anim() {
            ctx.clearRect(0,0,canvas.width, canvas.height); ctx.fillStyle="rgba(255,255,255,0.2)";
            ps.forEach(p => { ctx.font=p.s+"px serif"; ctx.fillText("‚ù§", p.x, p.y); p.y-=p.v; if(p.y<-50) p.y=canvas.height+50; });
            requestAnimationFrame(anim);
        }
        anim();
    }
</script>
</body>
</html>