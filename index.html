<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon C≈ìur pour Toi</title>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Raleway:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --bg-color: #1a2a2a; }
        body { margin: 0; font-family: 'Raleway', sans-serif; background-color: var(--bg-color); color: white; overflow-x: hidden; transition: 1s; }
        .container { max-width: 800px; margin: 0 auto; padding: 40px 20px; }
        .section-box { background: rgba(255,255,255,0.12); border: 1px solid rgba(255,255,255,0.2); backdrop-filter: blur(15px); border-radius: 25px; padding: 35px; margin-bottom: 40px; }
        .box-header { font-family: 'Great Vibes', cursive; font-size: 3.5em; text-align: center; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.15); padding-bottom: 10px; }
        
        /* STYLE SOUVENIRS */
        .memory-card { background: white; color: #333; border-radius: 20px; padding: 15px; margin-bottom: 25px; box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        .memory-card img { width: 100%; border-radius: 15px; display: block; height: auto; }
        .mem-title { font-family: 'Great Vibes', cursive; font-size: 2.2em; color: #1a2a2a; margin: 10px 0 5px 0; text-align: center; }
        .mem-text { font-family: 'Raleway', sans-serif; font-size: 1em; color: #555; text-align: center; padding: 0 10px 10px 10px; }

        /* LISTES AVEC COEURS */
        .love-line { display: flex; align-items: center; justify-content: space-between; background: rgba(255,255,255,0.08); padding: 15px 20px; border-radius: 15px; margin-bottom: 10px; }
        .fav-heart { cursor: pointer; font-size: 1.5em; color: rgba(255,255,255,0.3); transition: 0.3s; }
        .fav-heart.active { color: #ff4d4d; transform: scale(1.2); }

        /* √âDITEUR */
        #editor-ui input, #editor-ui textarea { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.2); background: rgba(0,0,0,0.3); color: white; margin-bottom: 10px; box-sizing: border-box; }
        .photo-entry { background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px dashed rgba(255,255,255,0.2); }
        .btn-add { background: rgba(255,255,255,0.2); color: white; border: 1px solid white; padding: 10px; border-radius: 10px; cursor: pointer; margin-bottom: 20px; width: 100%; }
        .btn-gen { background: white; color: black; border: none; padding: 20px; border-radius: 50px; cursor: pointer; width: 100%; font-weight: bold; font-size: 1.1em; }
        
        #share-area { display: none; text-align: center; margin-bottom: 20px; position: sticky; top: 10px; z-index: 10002; }
        .btn-share { background: #25d366; color: white; border: none; padding: 15px 30px; border-radius: 50px; cursor: pointer; font-weight: bold; }
        
        #welcome-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-color); display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 9999; }
        .heart-trigger { fill: white; width: 100px; height: 100px; cursor: pointer; animation: beat 1.4s infinite; }
        @keyframes beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        
        #music-toggle { position: fixed; bottom: 25px; right: 25px; width: 60px; height: 60px; background: white; border-radius: 50%; display: none; align-items: center; justify-content: center; z-index: 10000; cursor: pointer; }
        .hidden { display: none !important; }
        canvas { position: fixed; top: 0; left: 0; z-index: -1; pointer-events: none; }
    </style>
</head>
<body>

<canvas id="canvas-particles"></canvas>
<div id="share-area"><button class="btn-share" onclick="copyMagicLink()">üîó Copier le lien pour mon Mari</button></div>

<div class="container" id="editor-ui">
    <div class="section-box">
        <h1 style="font-family:'Great Vibes'; text-align:center; font-size:3em; margin:0 0 20px 0;">Atelier de Mme Thiandoum</h1>
        
        <label>Musique (Max 10 MB)</label>
        <input type="file" id="user-mp3" accept="audio/*" onchange="handleMusicUpload(this)">
        
        <label>Ton Po√®me</label><textarea id="user-poem" rows="3"></textarea>
        <label>Signature</label><input type="text" id="user-sig">

        <h3 style="text-align:center; margin-top:30px;">üì∏ Vos Souvenirs</h3>
        <div id="photo-list">
            <div class="photo-entry">
                <input type="file" class="mem-img" accept="image/*">
                <input type="text" class="mem-title-in" placeholder="Titre du souvenir">
                <textarea class="mem-text-in" placeholder="Petit texte d'accompagnement..." rows="2"></textarea>
            </div>
        </div>
        <button class="btn-add" onclick="addPhotoField()">+ Ajouter une autre photo</button>

        <label>Ses Qualit√©s (Une par ligne)</label>
        <textarea id="user-qualities" placeholder="Douceur&#10;Intelligence..."></textarea>

        <label>Tes Promesses (Une par ligne)</label>
        <textarea id="user-promises" placeholder="T'aimer toujours&#10;Te soutenir..."></textarea>

        <button class="btn-gen" onclick="previewSite()">Voir le r√©sultat ‚ú®</button>
    </div>
</div>

<div id="welcome-screen">
    <svg class="heart-trigger" onclick="unlockSite()" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
    <div style="font-family:'Great Vibes'; font-size:3em; margin-top:20px;">Bienvenue √† toi Nurul Qalbi‚ù§Ô∏è</div>
</div>

<div class="container hidden" id="final-site">
    <div class="section-box"><div class="box-header">Pour Toi MaVie, Cheikhna Thiandoum‚ù§Ô∏èü•π</div><div id="display-poem" class="poem-content"></div><div id="display-sig" style="text-align:right; font-family:'Great Vibes'; font-size:2em; margin-top:20px;"></div></div>
    
    <div id="display-memories"></div>

    <div class="section-box"><div class="box-header">Ce que j'aime chez toi</div><div id="list-qualities"></div></div>
    <div class="section-box"><div class="box-header">Mes Promesses</div><div id="list-promises"></div></div>
</div>

<div id="music-toggle" onclick="toggleAudio()"><svg viewBox="0 0 24 24" style="fill:#1a2a2a; width:30px;"><path d="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.85 14,18.71V20.77C18.03,19.86 21,16.28 21,12C21,7.72 18.03,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16.02C15.5,15.29 16.5,13.77 16.5,12M3,9V15H7L12,20V4L7,9H3Z"/></svg></div>
<audio id="main-audio" loop></audio>

<script>
    const params = new URLSearchParams(window.location.search);
    if(params.has('d')) {
        document.getElementById('editor-ui').classList.add('hidden');
        document.getElementById('share-area').classList.add('hidden');
        const data = JSON.parse(decodeURIComponent(escape(atob(params.get('d')))));
        window.addEventListener('load', () => { renderSite(data); document.getElementById('welcome-screen').style.display = 'flex'; startParticles(); });
    }

    function addPhotoField() {
        const div = document.createElement('div');
        div.className = 'photo-entry';
        div.innerHTML = `<input type="file" class="mem-img" accept="image/*"><input type="text" class="mem-title-in" placeholder="Titre du souvenir"><textarea class="mem-text-in" placeholder="Petit texte d'accompagnement..." rows="2"></textarea>`;
        document.getElementById('photo-list').appendChild(div);
    }

    function handleMusicUpload(input) {
        const file = input.files[0];
        if (file && file.size < 10 * 1024 * 1024) document.getElementById('main-audio').src = URL.createObjectURL(file);
        else if(file) alert("Fichier trop lourd (>10MB)");
    }

    function previewSite() {
        const data = { p: document.getElementById('user-poem').value, s: document.getElementById('user-sig').value, q: document.getElementById('user-qualities').value, pr: document.getElementById('user-promises').value };
        renderSite(data);
        
        const memDisp = document.getElementById('display-memories'); memDisp.innerHTML = '';
        const entries = document.querySelectorAll('.photo-entry');
        entries.forEach(entry => {
            const img = entry.querySelector('.mem-img').files[0];
            const title = entry.querySelector('.mem-title-in').value;
            const text = entry.querySelector('.mem-text-in').value;
            if(img) {
                const url = URL.createObjectURL(img);
                memDisp.innerHTML += `<div class="section-box"><div class="memory-card"><img src="${url}"><div class="mem-title">${title}</div><div class="mem-text">${text}</div></div></div>`;
            }
        });

        document.getElementById('editor-ui').classList.add('hidden');
        document.getElementById('welcome-screen').style.display = 'flex';
        document.getElementById('share-area').style.display = 'block';
        startParticles();
    }

    function renderSite(data) {
        document.getElementById('display-poem').innerText = data.p;
        document.getElementById('display-sig').innerText = data.s;
        renderList('list-qualities', data.q);
        renderList('list-promises', data.pr);
    }

    function renderList(targetId, text) {
        const container = document.getElementById(targetId); container.innerHTML = '';
        text.split('\n').filter(l => l.trim()!=='').forEach(line => {
            const div = document.createElement('div'); div.className = 'love-line';
            div.innerHTML = `<span>${line}</span><span class="fav-heart" onclick="this.classList.toggle('active')">‚ù§</span>`;
            container.appendChild(div);
        });
    }

    function copyMagicLink() {
        const data = { p: document.getElementById('user-poem').value, s: document.getElementById('user-sig').value, q: document.getElementById('user-qualities').value, pr: document.getElementById('user-promises').value };
        const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(data))));
        navigator.clipboard.writeText(window.location.origin + window.location.pathname + '?d=' + encoded).then(() => alert("Lien copi√© !"));
    }

    function unlockSite() {
        document.getElementById('welcome-screen').style.opacity = '0';
        setTimeout(() => {
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('final-site').classList.remove('hidden');
            if(document.getElementById('main-audio').src) {
                document.getElementById('music-toggle').style.display = 'flex';
                document.getElementById('main-audio').play();
            }
        }, 1000);
    }

    function toggleAudio() { const a = document.getElementById('main-audio'); a.paused ? a.play() : a.pause(); }

    function startParticles() {
        const canvas = document.getElementById('canvas-particles'); const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        let ps = []; for(let i=0; i<30; i++) ps.push({x: Math.random()*canvas.width, y: canvas.height+50, s: Math.random()*20+10, v: Math.random()*0.5+0.2});
        function anim() {
            ctx.clearRect(0,0,canvas.width, canvas.height); ctx.fillStyle="rgba(255,255,255,0.2)";
            ps.forEach(p => { ctx.font=p.s+"px serif"; ctx.fillText("‚ù§", p.x, p.y); p.y-=p.v; if(p.y<-50) p.y=canvas.height+50; });
            requestAnimationFrame(anim);
        }
        anim();
    }
</script>
</body>
</html>


